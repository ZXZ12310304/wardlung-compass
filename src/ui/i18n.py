from __future__ import annotations

from typing import Any, Dict


STRINGS: Dict[str, Dict[str, Any]] = {
    "zh": {
        "app_title": "MedGemma：智能临床助手",
        "app_window_title": "MedGemma V3",
        "login_title": "登录",
        "login_role": "角色",
        "role_patient": "患者",
        "role_nurse": "护士",
        "role_doctor": "医生",
        "login_ward": "病区ID",
        "login_patient": "患者/员工ID",
        "login_code": "访问码",
        "login_btn": "登录",
        "menu_title": "菜单",
        "logout": "退出登录",
        "session_not_logged_in": "Session: 未登录",
        "session_template": "Session:\n- role: {role}\n- ward_id: {ward_id}\n- patient_id: {patient_id}",
        "unknown": "未知",
        "yes": "是",
        "no": "否",
        "na": "N/A",
        "route_label": "route",
        "basis_label": "basis",
        "rag_used_label": "rag_used",
        "enabled_label": "启用",
        "quality_score_label": "质量分",
        "issues_label": "问题",
        "audio_title": "音频",
        "image_title": "图像",
        "error_select_role": "请选择角色。",
        "error_patient_required": "patient_id 不能为空。",
        "error_ward_required": "ward_id 不能为空。",
        "error_code_wrong": "access_code 错误。",
        "error_staff_required": "staff_id 不能为空。",
        "error_staff_not_found": "staff_id 不存在或不匹配。",
        "error_auth": "登录失效或权限不足。",
        "error_forbidden": "无权限或患者不存在。",
        "error_select_patient": "请选择患者。",
        "error_card_empty": "请先生成或填写说明卡内容。",
        "error_submit_failed": "提交失败：{msg}",
        "error_generate_failed": "生成失败：{msg}",
        "error_publish_failed": "发布失败：{msg}",
        "error_hold_failed": "标记失败：{msg}",
        "submit_success": "提交成功 | stored={stored}{warn}",
        "warn_red_flag": "注意：如出现气短明显/胸痛明显/意识差/持续高热，请及时通知护士或医生。",
        "card_published": "已发布到患者端 | card_id: {card_id}",
        "card_held": "已标记为需要医生确认 | card_id: {card_id}",
        "card_no_published": "医护尚未发布说明，有问题请呼叫护士。",
        "card_published_at": "**发布于：{ts}**",
        "card_title_today_plan": "今日护理说明",
        "card_section_what_we_know": "我们已知的情况",
        "card_section_what_to_do_today": "今天需要做的事",
        "card_section_red_flags": "需要立刻呼叫护士/医生的情况",
        "card_footer_not_medical_advice": "此内容用于健康教育与护理沟通，不替代医生诊疗。",
        "card_draft_hint": "你可以在发布前编辑这份草稿。",
        "carecard_title": "Care Cards",
        "carecard_level_label": "卡片类型",
        "carecard_level_nursing": "护理卡",
        "carecard_level_medical": "医疗卡",
        "carecard_generate_draft_btn": "生成草稿",
        "carecard_save_draft_btn": "保存草稿",
        "carecard_publish_btn": "发布",
        "carecard_hold_btn": "暂存/待审核",
        "carecard_recommendations_title": "推荐 Care Cards",
        "carecard_use_recommendation_btn": "使用推荐草稿",
        "carecard_not_published_hint": "暂无已发布的护理卡。",
        "carecard_section_actions": "今日要点",
        "carecard_section_redflags": "需立即通知护士/医生",
        "carecard_section_followup": "后续事项",
        "carecard_footer_not_medical_advice": "此内容用于健康教育与护理沟通，不替代医生诊断。",
        "risk_title": "???",
        "risk_level_label": "????",
        "risk_level_green": "??",
        "risk_level_yellow": "??",
        "risk_level_red": "??",
        "risk_flags_title": "????",
        "risk_next_actions": "?????",
        "handover_title": "????",
        "handover_generate": "??????",
        "handover_save": "??????",
        "handover_latest": "???????{ts}?",
        "page_placeholder": "这是占位页面，用于后续功能接入。\n\n当前阶段仅完成登录与主壳布局。",
        "patient_today_title": "今日与聊天",
        "patient_today_record": "今日记录（点选即可）",
        "date_today": "日期（今天）",
        "diet_section": "吃饭情况",
        "diet_intake_label": "摄入量",
        "diet_texture_label": "质地/状态（可多选）",
        "diet_preference_label": "口味/偏好（可多选）",
        "diet_other_label": "其他饮食情况（可选）",
        "diet_other_ph": "比如：吃不下、吃得很清淡等",
        "diet_prefix_intake": "摄入量",
        "diet_prefix_texture": "质地",
        "diet_prefix_preference": "口味",
        "diet_prefix_other": "其他",
        "diet_sep": "; ",
        "water_label": "今天喝水情况",
        "sleep_label": "昨晚睡眠",
        "self_report_notice": "提示：以下为自我描述，系统会转换为估计值用于趋势分析，不等同于真实测量。",
        "symptom_section": "今天有没有这些不舒服（可多选）",
        "symptom_main_label": "主要症状",
        "cough_type_label": "咳嗽类型（可选）",
        "sputum_color_label": "痰的颜色（可选）",
        "symptom_other_label": "其他不舒服（可选）",
        "symptom_other_ph": "比如：头痛、咽痛、头晕等",
        "meds_section": "用药情况",
        "meds_label": "今天吃过哪些药（可多选）",
        "meds_other_label": "其他药（可选）",
        "meds_other_ph": "比如：×××",
        "meds_adherence_label": "今天是否按时服药",
        "meds_missed_label": "今天是否漏服",
        "meds_adverse_label": "是否有不适反应（可多选）",
        "submit_daily_log_btn": "提交今日记录",
        "summary_disabled_title": "评估由护士/医生生成（此处仅占位）",
        "age_label": "年龄（可选）",
        "sex_label": "性别（可选）",
        "chief_label": "今天最难受的是（可多选）",
        "chief_other_label": "其他主要不舒服（可选）",
        "chief_other_ph": "比如：喉咙痛、头痛等",
        "history_label": "以前有这些情况吗（可多选）",
        "history_other_label": "其他病史（可选）",
        "history_other_ph": "比如：肾病、肝病等",
        "history_none_text": "无明显既往史",
        "history_unknown_text": "既往史不详",
        "plan_label": "希望我们帮助什么（可选）",
        "plan_note_label": "补充说明（可选）",
        "plan_note_ph": "想告诉医生/护士的事",
        "list_sep": "；",
        "assess_btn_disabled": "今日小结（禁用）",
        "latest_context_title": "我的最新记录摘要",
        "refresh_context_btn": "刷新摘要",
        "patient_card_title": "今日说明卡",
        "refresh_card_btn": "刷新说明卡",
        "chat_title": "聊天问答",
        "chat_input_label": "请输入问题",
        "chat_audio_label": "语音输入（可选）",
        "chat_ask_btn": "提问",
        "chat_answer_title": "回答",
        "chat_actions_title": "建议操作",
        "chat_escalation_title": "是否需要升级通知",
        "chat_escalation_yes": "需要立即通知护士/医生",
        "chat_escalation_no": "暂无需立即升级",
        "chat_new_gaps_title": "新发现缺口",
        "chat_flags_title": "安全标记",
        "chat_asr_quality_title": "语音质量",
        "patient_profile_title": "我的信息",
        "patient_section_title": "### 患者",
        "patient_info_missing": "- 未找到患者信息",
        "patient_info_line": "- bed_id: {bed_id} | age: {age} | sex: {sex}",
        "latest_daily_title": "### 最新日记录",
        "latest_assessment_title": "### 最新评估",
        "label_date": "日期",
        "label_diet": "饮食",
        "label_water_ml": "饮水(ml)",
        "label_sleep_hours": "睡眠(小时)",
        "label_assessment_id": "assessment_id",
        "label_primary": "主诊断",
        "label_risk": "风险",
        "label_gaps": "gaps",
        "label_basis": "basis",
        "label_gaps_count": "gaps_count",
        "daily_none": "- 未提交",
        "assessment_none": "- 未生成",
        "patient_basic_missing": "- 未找到患者基本信息",
        "timeline_title": "### 时间提示",
        "timeline_daily_log": "- latest_daily_log: {ts}",
        "timeline_nurse_admin": "- latest_nurse_admin: {ts}",
        "ward_dashboard_title": "病房总览",
        "ward_list_title": "病房患者列表",
        "refresh_patient_list_btn": "刷新患者列表",
        "patient_count_template": "患者总数: {count}\n\n前 5: {top5}",
        "select_patient_label": "选择患者",
        "summary_title": "快速摘要",
        "generate_assessment_title": "生成评估",
        "generate_assessment_btn": "生成评估",
        "field_chief": "chief",
        "field_history": "history",
        "field_intern_plan": "intern_plan",
        "tool_trace_title": "### 工具轨迹",
        "gaps_title": "### 信息缺口",
        "diagnosis_title": "### 诊断摘要",
        "patient_card_draft_title": "患者说明卡（草稿）",
        "card_draft_btn": "生成患者说明卡草稿",
        "card_md_label": "patient_card_md",
        "card_publish_btn": "发布给患者",
        "card_hold_btn": "暂存 / 需医生确认",
        "card_status_default": "-",
        "draft_id_label": "draft_id",
        "menu_patient_today": "今日与聊天",
        "menu_patient_reports": "我的报告",
        "menu_patient_cards": "护理卡",
        "menu_nurse_dashboard": "病房总览",
        "menu_nurse_vitals": "体征与给药",
        "menu_nurse_handover": "交班",
        "menu_doctor_patients": "我的患者",
        "menu_doctor_reports": "报告",
        "menu_doctor_rerun": "重新评估",
        "choice_unknown": "不清楚",
        "choice_yes": "是",
        "choice_no": "否",
        "sex_male": "男",
        "sex_female": "女",
        "sex_unspecified": "不方便说",
        "water_choices": ["正常", "喝得少", "喝得多", "不清楚"],
        "sleep_choices": ["正常", "睡得少", "睡得多", "不清楚"],
        "diet_intake_choices": ["正常", "吃得少", "吃得多", "几乎没吃", "不清楚"],
        "diet_texture_choices": ["清淡", "软食", "流食", "无食欲"],
        "diet_preference_choices": ["偏辛辣/重口", "甜食多/高糖", "油腻"],
        "symptom_choices": [
            "无明显不适",
            "咳嗽",
            "发烧/发热",
            "气短/喘",
            "气短明显",
            "胸痛",
            "胸痛明显",
            "咳痰",
            "乏力",
            "食欲差",
            "咽痛/鼻塞",
            "意识差/嗜睡",
            "持续高热",
        ],
        "cough_type_choices": ["无/不清楚", "干咳", "有痰"],
        "sputum_color_choices": ["无/不清楚", "清/白", "黄绿", "带血"],
        "meds_choices": ["未服药", "退烧药", "止咳药", "阿莫西林", "阿奇霉素", "头孢", "不清楚"],
        "adverse_choices": ["恶心", "腹泻", "皮疹", "不清楚"],
        "chief_choices": ["咳嗽", "发烧/发热", "气短/喘", "胸痛", "乏力", "没什么不舒服"],
        "history_choices": [
            "慢性肺病/哮喘",
            "慢性心脏病",
            "糖尿病",
            "高血压",
            "吸烟",
            "最近用过抗生素",
            "都没有",
            "不清楚",
        ],
        "plan_choices": ["希望确认是否严重", "希望缓解症状", "只是日常跟进", "不清楚"],
        "assess_btn": "生成今日摘要",
        "patient_voice_label": "语音补充（自动提交）",
        "medical_card_title": "医疗说明卡（医生审批）",
        "medical_card_publish": "批准并发布",
        "medical_card_hold": "暂存/需复核",
        "medical_card_none": "暂无医疗卡",
        "carecard_audio_btn": "Play / Generate Audio",
        "carecard_latest_title": "Latest Care Card",
        "latest_vitals_title": "Latest Vitals",
        "trends_title": "3-day trends",
        "anomalies_title": "Today's anomalies",
        "assessment_update_title": "Assessment Update",
        "assessment_update_btn": "Generate Assessment Update",
        "report_html_title": "Latest Report",
        "report_tool_trace_title": "Tool Trace",
        "report_evidence_title": "RAG Evidence",
        "rerun_title": "Re-run Assessment",
        "rerun_btn": "Re-run Assessment",
    },
    "en": {
        "app_title": "MedGemma: Smart Clinical Assistant",
        "app_window_title": "MedGemma V3",
        "login_title": "Login",
        "login_role": "Role",
        "role_patient": "Patient",
        "role_nurse": "Nurse",
        "role_doctor": "Doctor",
        "login_ward": "Ward ID",
        "login_patient": "Patient/Staff ID",
        "login_code": "Access Code",
        "login_btn": "Login",
        "menu_title": "Menu",
        "logout": "Logout",
        "session_not_logged_in": "Session: not logged in",
        "session_template": "Session:\n- role: {role}\n- ward_id: {ward_id}\n- patient_id: {patient_id}",
        "unknown": "unknown",
        "yes": "Yes",
        "no": "No",
        "na": "N/A",
        "route_label": "route",
        "basis_label": "basis",
        "rag_used_label": "rag_used",
        "enabled_label": "enabled",
        "quality_score_label": "quality_score",
        "issues_label": "issues",
        "audio_title": "Audio",
        "image_title": "Image",
        "error_select_role": "Please select a role.",
        "error_patient_required": "patient_id is required.",
        "error_ward_required": "ward_id is required.",
        "error_code_wrong": "access_code is incorrect.",
        "error_staff_required": "staff_id is required.",
        "error_staff_not_found": "staff_id not found or mismatch.",
        "error_auth": "Session expired or insufficient permissions.",
        "error_forbidden": "No permission or patient not found.",
        "error_select_patient": "Please select a patient.",
        "error_card_empty": "Please generate or enter the card content first.",
        "error_submit_failed": "Submit failed: {msg}",
        "error_generate_failed": "Generate failed: {msg}",
        "error_publish_failed": "Publish failed: {msg}",
        "error_hold_failed": "Hold failed: {msg}",
        "submit_success": "Submitted | stored={stored}{warn}",
        "warn_red_flag": "Notice: If severe shortness of breath/chest pain/altered mental status/high fever, notify nurse/doctor immediately.",
        "card_published": "Published to patient | card_id: {card_id}",
        "card_held": "Marked as needs review | card_id: {card_id}",
        "card_no_published": "No card published yet. Please contact the nurse if needed.",
        "card_published_at": "**Published at: {ts}**",
        "card_title_today_plan": "Today's care note",
        "card_section_what_we_know": "What we know",
        "card_section_what_to_do_today": "What to do today",
        "card_section_red_flags": "Red flags (call nurse/doctor now)",
        "card_footer_not_medical_advice": "For education and care coordination only. Not medical advice.",
        "card_draft_hint": "You can edit this draft before publishing.",
        "carecard_title": "Care Cards",
        "carecard_level_label": "Card level",
        "carecard_level_nursing": "Nursing",
        "carecard_level_medical": "Medical",
        "carecard_generate_draft_btn": "Generate Draft",
        "carecard_save_draft_btn": "Save Draft",
        "carecard_publish_btn": "Publish",
        "carecard_hold_btn": "Hold / Needs Review",
        "carecard_recommendations_title": "Recommended Care Cards",
        "carecard_use_recommendation_btn": "Use Recommendation",
        "carecard_not_published_hint": "No published nursing card yet.",
        "carecard_section_actions": "Today's actions",
        "carecard_section_redflags": "Red flags",
        "carecard_section_followup": "Follow-up",
        "carecard_footer_not_medical_advice": "For education and nursing communication only.",
        "risk_title": "Risk Light",
        "risk_level_label": "Risk level",
        "risk_level_green": "Green",
        "risk_level_yellow": "Yellow",
        "risk_level_red": "Red",
        "risk_flags_title": "Risk flags",
        "risk_next_actions": "Next actions",
        "handover_title": "Handover (SBAR)",
        "handover_generate": "Generate Handover",
        "handover_save": "Save Handover",
        "handover_latest": "Latest handover ({ts})",
        "page_placeholder": "Placeholder page for future features.\n\nCurrent phase: login + shell layout only.",
        "patient_today_title": "Today & Chat",
        "patient_today_record": "Today Record (tap to choose)",
        "date_today": "Date (today)",
        "diet_section": "Diet",
        "diet_intake_label": "Intake",
        "diet_texture_label": "Texture (multi-select)",
        "diet_preference_label": "Preference (multi-select)",
        "diet_other_label": "Other diet info (optional)",
        "diet_other_ph": "e.g., poor appetite, very light diet",
        "diet_prefix_intake": "intake",
        "diet_prefix_texture": "texture",
        "diet_prefix_preference": "preference",
        "diet_prefix_other": "other",
        "diet_sep": "; ",
        "water_label": "Water intake today",
        "sleep_label": "Sleep last night",
        "self_report_notice": "Self-reported info will be converted to estimates for trend tracking, not exact measurements.",
        "symptom_section": "Any discomfort today (multi-select)",
        "symptom_main_label": "Symptoms",
        "cough_type_label": "Cough type (optional)",
        "sputum_color_label": "Sputum color (optional)",
        "symptom_other_label": "Other discomfort (optional)",
        "symptom_other_ph": "e.g., headache, sore throat, dizziness",
        "meds_section": "Medications",
        "meds_label": "What meds did you take today? (multi-select)",
        "meds_other_label": "Other meds (optional)",
        "meds_other_ph": "e.g., name of medicine",
        "meds_adherence_label": "Took meds on time today",
        "meds_missed_label": "Missed any dose today",
        "meds_adverse_label": "Any adverse reactions (multi-select)",
        "submit_daily_log_btn": "Submit Daily Log",
        "summary_disabled_title": "Assessment is generated by nurse/doctor (placeholder)",
        "age_label": "Age (optional)",
        "sex_label": "Sex (optional)",
        "chief_label": "Main discomfort today (multi-select)",
        "chief_other_label": "Other main discomfort (optional)",
        "chief_other_ph": "e.g., sore throat, headache",
        "history_label": "Any of these history items? (multi-select)",
        "history_other_label": "Other history (optional)",
        "history_other_ph": "e.g., kidney/liver disease",
        "history_none_text": "No significant history",
        "history_unknown_text": "History unknown",
        "plan_label": "What help do you want? (optional)",
        "plan_note_label": "Additional notes (optional)",
        "plan_note_ph": "Anything you want the nurse/doctor to know",
        "list_sep": "; ",
        "assess_btn_disabled": "Generate Today Summary (disabled)",
        "latest_context_title": "My latest record summary",
        "refresh_context_btn": "Refresh Summary",
        "patient_card_title": "Today's Patient Card",
        "refresh_card_btn": "Refresh Card",
        "chat_title": "Chat Q&A",
        "chat_input_label": "Your question",
        "chat_audio_label": "Voice input (optional)",
        "chat_ask_btn": "Ask",
        "chat_answer_title": "Answer",
        "chat_actions_title": "Suggested Actions",
        "chat_escalation_title": "Escalation",
        "chat_escalation_yes": "Escalation needed",
        "chat_escalation_no": "No immediate escalation",
        "chat_new_gaps_title": "New Gaps",
        "chat_flags_title": "Safety Flags",
        "chat_asr_quality_title": "ASR Quality",
        "patient_profile_title": "My Info",
        "patient_section_title": "### Patient",
        "patient_info_missing": "- Patient info not found",
        "patient_info_line": "- bed_id: {bed_id} | age: {age} | sex: {sex}",
        "latest_daily_title": "### Latest DailyLog",
        "latest_assessment_title": "### Latest Assessment",
        "label_date": "date",
        "label_diet": "diet",
        "label_water_ml": "water_ml",
        "label_sleep_hours": "sleep_hours",
        "label_assessment_id": "assessment_id",
        "label_primary": "primary",
        "label_risk": "risk",
        "label_gaps": "gaps",
        "label_basis": "basis",
        "label_gaps_count": "gaps_count",
        "daily_none": "- No submission",
        "assessment_none": "- Not generated",
        "patient_basic_missing": "- Patient info not found",
        "timeline_title": "### Timeline Hint",
        "timeline_daily_log": "- latest_daily_log: {ts}",
        "timeline_nurse_admin": "- latest_nurse_admin: {ts}",
        "ward_dashboard_title": "Ward Dashboard",
        "ward_list_title": "Ward Patient List",
        "refresh_patient_list_btn": "Refresh Patient List",
        "patient_count_template": "Total patients: {count}\n\nTop 5: {top5}",
        "select_patient_label": "Select Patient",
        "summary_title": "Quick Summary",
        "generate_assessment_title": "Generate Assessment",
        "generate_assessment_btn": "Generate Assessment",
        "field_chief": "chief",
        "field_history": "history",
        "field_intern_plan": "intern_plan",
        "tool_trace_title": "### Tool Trace",
        "gaps_title": "### Gaps",
        "diagnosis_title": "### Diagnosis",
        "patient_card_draft_title": "Patient Card (Draft)",
        "card_draft_btn": "Generate Patient Card Draft",
        "card_md_label": "patient_card_md",
        "card_publish_btn": "Publish to Patient",
        "card_hold_btn": "Hold / Need Doctor Review",
        "card_status_default": "-",
        "draft_id_label": "draft_id",
        "menu_patient_today": "Today & Chat",
        "menu_patient_reports": "My Reports",
        "menu_patient_cards": "Care Cards",
        "menu_nurse_dashboard": "Ward Dashboard",
        "menu_nurse_vitals": "Vitals & MAR",
        "menu_nurse_handover": "Handover",
        "menu_doctor_patients": "My Patients",
        "menu_doctor_reports": "Reports",
        "menu_doctor_rerun": "Re-run Assessment",
        "choice_unknown": "Unknown",
        "choice_yes": "Yes",
        "choice_no": "No",
        "sex_male": "Male",
        "sex_female": "Female",
        "sex_unspecified": "Prefer not to say",
        "water_choices": ["Normal", "Low", "High", "Unknown"],
        "sleep_choices": ["Normal", "Low", "High", "Unknown"],
        "diet_intake_choices": ["Normal", "Low", "High", "Almost none", "Unknown"],
        "diet_texture_choices": ["Light", "Soft", "Liquid", "No appetite"],
        "diet_preference_choices": ["Spicy/heavy", "High sugar", "Greasy"],
        "symptom_choices": [
            "No obvious symptoms",
            "Cough",
            "Fever",
            "Shortness of breath",
            "Severe shortness of breath",
            "Chest pain",
            "Severe chest pain",
            "Sputum",
            "Fatigue",
            "Poor appetite",
            "Sore throat/nasal congestion",
            "Altered mental status",
            "Persistent high fever",
        ],
        "cough_type_choices": ["None/Unknown", "Dry cough", "Productive cough"],
        "sputum_color_choices": ["None/Unknown", "Clear/white", "Yellow/green", "Blood-tinged"],
        "meds_choices": [
            "No meds",
            "Antipyretic",
            "Cough medicine",
            "Amoxicillin",
            "Azithromycin",
            "Cephalosporin",
            "Unknown",
        ],
        "adverse_choices": ["Nausea", "Diarrhea", "Rash", "Unknown"],
        "chief_choices": ["Cough", "Fever", "Shortness of breath", "Chest pain", "Fatigue", "No major discomfort"],
        "history_choices": [
            "Chronic lung disease/asthma",
            "Chronic heart disease",
            "Diabetes",
            "Hypertension",
            "Smoking",
            "Recent antibiotics",
            "None",
            "Unknown",
        ],
        "plan_choices": ["Check severity", "Relieve symptoms", "Daily follow-up", "Unknown"],
        "assess_btn": "Generate Today Summary",
        "patient_voice_label": "Voice note (auto submit)",
        "medical_card_title": "Medical Care Card",
        "medical_card_publish": "Approve & Publish",
        "medical_card_hold": "Hold",
        "medical_card_none": "No medical card yet",
        "carecard_audio_btn": "Play / Generate Audio",
        "carecard_latest_title": "Latest Care Card",
        "latest_vitals_title": "Latest Vitals",
        "trends_title": "3-day trends",
        "anomalies_title": "Today's anomalies",
        "assessment_update_title": "Assessment Update",
        "assessment_update_btn": "Generate Assessment Update",
        "report_html_title": "Latest Report",
        "report_tool_trace_title": "Tool Trace",
        "report_evidence_title": "RAG Evidence",
        "rerun_title": "Re-run Assessment",
        "rerun_btn": "Re-run Assessment",
    },
}


def t(lang: str, key: str, **kwargs: Any) -> Any:
    lang_dict = STRINGS.get(lang) or STRINGS["zh"]
    value = lang_dict.get(key, key)
    if isinstance(value, str) and kwargs:
        try:
            return value.format(**kwargs)
        except Exception:
            return value
    return value
